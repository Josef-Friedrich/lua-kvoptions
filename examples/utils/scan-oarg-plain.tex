\input luakeys.tex

\def\mycmd{\directlua{
    local lk = luakeys.new()
    local oarg = lk.utils.scan_oarg('[', ']')
    if oarg then
      local keys = lk.parse(oarg)
      for key, value in pairs(keys) do
        tex.print('oarg: key: “' .. key .. '” value: “' .. value .. '”;')
      end
    end
    local marg = token.scan_argument()
    tex.print('marg: “' .. marg .. '”')
  }% <- important
}

\mycmd[key=value]{marg}
% oarg: key: “key” value: “value”; marg: “marg”

\mycmd{marg without oarg}
% marg: “marg without oarg”

end
\bye
